import React from 'react'
import { IMovieItem, IState } from '../interfaces'
import { connect } from 'react-redux'
import { getMoviesData } from '../actions/fetching-actions'
import { IFilter } from '../actions/filter-actions'
import Cards from '../Components/Cards'

interface State {
  errMessage: string,
  moviesList: IMovieItem[]
  filter: IFilter
}

interface Props extends State {
  getMoviesData: typeof getMoviesData
}
const mapStateToProps = (state: IState): State => ({
  moviesList: state.moviesList,
  errMessage: state.fetchingStatus.errMessage,
  filter: state.visibilityFilter
  
})

class MovieList extends React.Component<Props> {
  componentDidMount() {
    this.props.getMoviesData();
  }

  getFilteredMovies = () => {
    
  }

  

  render() {
    const { errMessage, moviesList } = this.props
    const years = moviesList.length > 0 ? moviesList.map((item: IMovieItem) => item.year)

      .filter((v, i, a) => a.indexOf(v) === i)
      .sort((a, b) => a - b) : [];
    console.log('years', years)

    return (
      <>{errMessage && <p>{errMessage}</p>}

        <div className="movie-list">
          {years.map(year => {
            return (
              <div className="sort-by-year-block">
                <div className="year">{year}</div>
                <Cards moviesList={moviesList} year={year} />
              </div>
            )
          })}
        </div>
      </>

    )
  }
}


export default connect(mapStateToProps, { getMoviesData })(MovieList)